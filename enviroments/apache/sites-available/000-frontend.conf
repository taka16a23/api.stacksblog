<VirtualHost *:80>

    ErrorLog ${APACHE_LOG_DIR}/react_error.log
    CustomLog ${APACHE_LOG_DIR}/react_access.log combined

    DocumentRoot /var/www/webapp/frontend/build/

    RewriteEngine On

    # mime settings
    RemoveLanguage .br

    # Encoding for Brotli files
    AddEncoding br .br

    # Set gzip encoding instead of setting as a Content Type
    RemoveType .gz
    AddEncoding x-gzip .gz

    # Mapping foo.suffix.gz or foo.suffix.br => Type
    # see following repositories for recognized suffixes
    # https://github.com/michel-kraemer/metalsmith-brotli
    # https://github.com/ludovicofischer/metalsmith-gzip
    AddType "text/html" .html.br .htm.br .html.gz .htm.gz .html.htm
    AddType "text/css" .css.br css.gz .css
    AddType "text/plain" .txt.br txt.gz .txt
    AddType "text/xml" .xml.br .xml.gz .xml
    AddType "application/javascript" .js.br .js.gz .js
    AddType "application/json" .json.br .json.gz .json

    # Proxy configuration
    Header append Vary Accept-Encoding

    RewriteCond %{HTTP:Accept-Encoding} br
    RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME}.br -s
    RewriteRule ^(.*)$ %{DOCUMENT_ROOT}/%{REQUEST_FILENAME}.br [E=no-gzip,L]

    RewriteCond %{HTTP:Accept-Encoding} gzip
    RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME}.gz -s
    RewriteRule ^(.*)$ %{DOCUMENT_ROOT}/%{REQUEST_FILENAME}.gz [E=no-gzip,L]

    <Directory "/var/www/webapp/frontend/build">
        Options Indexes FollowSymLinks
        AllowOverride All
        Options -MultiViews
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^ index.html [QSA,L]
        Require all granted
    </Directory>

</VirtualHost>
